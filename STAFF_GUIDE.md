# 職員向けガイド

訪問予約管理システムの職員向け操作方法を説明します。

## 1. 予約管理Webアプリの使い方

### 1-1. アクセス
職員用WebアプリのURLにアクセスしてください。
- 組織アカウントでのログインが必要です

### 1-2. 予約検索
**検索方法を選択:**
- 予約ID
- 氏名
- メールアドレス

**検索値を入力して「検索」をクリック**

**検索結果:**
- 有効な予約が上部に表示
- 完了・キャンセル済みの予約は下部にグレー表示
- 予約をクリックで詳細を表示

### 1-3. 予約詳細の確認
詳細画面で以下を確認できます:
- 予約ID
- 氏名、メール、電話番号
- 所属機関
- 訪問目的
- 訪問日一覧（各日のステータス付き）
- 追加情報（同行人数、OPAC URL、データベース名）

## 2. 訪問日の変更

### 2-1. 変更画面を開く
予約詳細画面で「訪問日変更」ボタンをクリック

### 2-2. 削除する訪問日を選択
- 有効な訪問日にチェックボックスが表示
- 削除したい日付にチェック

### 2-3. 追加する訪問日を選択
- 営業日リストから追加したい日付にチェック
- 複数選択可

### 2-4. 変更実行
「変更実行」ボタンをクリック
- 確認ダイアログが表示
- OKで処理実行

**自動処理:**
- ✅ VisitDatesシート更新
- ✅ Reservationsシート更新
- ✅ Googleカレンダー更新（変更履歴付き）
- ✅ 利用者へ確認メール送信

## 3. 予約のキャンセル

### 3-1. キャンセル実行
予約詳細画面で「予約キャンセル」ボタンをクリック

### 3-2. 確認
確認ダイアログでOKをクリック

**自動処理:**
- ✅ 予約ステータスを「キャンセル」に変更
- ✅ すべての訪問日を「キャンセル」に変更
- ✅ Googleカレンダーのイベント削除
- ✅ 利用者へキャンセル確認メール送信

## 4. QRコード受付

### 4-1. QRコードをスキャン
利用者が提示したQRコードをスマートフォンやタブレットでスキャン

### 4-2. 予約確認画面
自動的に予約情報が表示されます:
- 予約ID
- 氏名
- 訪問日
- その他の予約情報

### 4-3. 受付完了
「受付完了」ボタンをクリック

**自動処理:**
- ✅ 該当訪問日のステータスを「完了」に更新
- ✅ すべての訪問日が完了した場合、予約全体を「完了」に更新

## 5. 変更・キャンセル依頼の処理

### 5-1. 依頼通知メールを確認
利用者から変更・キャンセル依頼があると、職員メールアドレスに通知が届きます。

### 5-2. 管理Webアプリで処理
1. 予約IDで検索
2. 詳細を確認
3. 「訪問日変更」または「予約キャンセル」で処理

### 5-3. 処理完了
自動的に利用者へ完了メールが送信されます。

## 6. フォームの管理

### 6-1. FormQuestionsシートで質問項目を管理
- 項目の追加・削除・順序変更が可能
- 選択肢の変更も可能

### 6-2. フォーム再構築
FormQuestionsシートを編集した後:
1. Apps Scriptエディタを開く
2. `rebuildForm()` 関数を実行

**注意:** 
- フォームURLが変更されるため、利用者への案内を更新してください
- 過去のフォームは自動的に削除されます

### 6-3. セクション説明文の編集
各セクションのGoogleドキュメントを直接編集
- 変更後、`rebuildForm()` で反映

## 7. 営業日カレンダーの管理

### 7-1. Calendarシートで営業日を管理
| 日付 | 営業日フラグ | 開館時間 | 備考 |
|---|---|---|---|
| 2026/01/17 | TRUE | 9:00-20:00 | |
| 2026/01/18 | FALSE | | 休館日 |

### 7-2. 自動更新
毎日午前0時に自動的にフォームの訪問日選択肢が更新されます。

### 7-3. 手動更新
即座に反映したい場合:
1. Apps Scriptエディタを開く
2. `updateBusinessDaysInForm()` 関数を実行

## 8. トラブルシューティング

### QRコード受付エラー
**「予約が見つかりません」**
- 予約IDが正しいか確認
- Reservationsシートに該当データがあるか確認

**「本日は訪問予定日ではありません」**
- 訪問日が今日の日付と一致しているか確認
- VisitDatesシートのステータスが「有効」か確認

### メール送信エラー
- STAFF_EMAILがConfigシートに正しく設定されているか確認
- Gmail送信制限に達していないか確認

### カレンダー連携エラー
- CALENDAR_IDがConfigシートに正しく設定されているか確認
- カレンダーの共有設定を確認

## 9. データのバックアップ

定期的にスプレッドシートのコピーを作成することを推奨します:
1. 「ファイル」→「コピーを作成」
2. 日付を含む名前で保存

## お問い合わせ

システムに関する技術的な問題は、システム管理者にお問い合わせください。